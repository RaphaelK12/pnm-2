version: 2.1
executors:
  default:
    docker:
      - image: circleci/node:8.11.4

jobs:
  deploy:
    executor:
      name: default
    steps:
      - checkout
      - run:
          name: install dependencies
          command: |
              npm install gitbook-cli
              echo "gitbook-cli installed"
              git config --global user.name  "ToruNiina"
              git config --global user.email "niina.toru.68u@gmail.com"
              echo "git configured"
              gitbook install
              echo "gitbook plugins are installed"
              gitbook build
              echo "html built"
              cd _book/
              git init
              git commit --allow-empty -m '[ci skip] update docs'
              git checkout -b gh-pages
              git add .
              git commit -am '[ci skip] update docs'
              git push --force git@github.com:ToruNiina/pnm.git gh-pages


workflows:
  setup_and_deploy:
    jobs:
      - deploy:
          name: update docs
          filters:
            branches:
              only: master
