version: 2.1
executors:
  default:
    docker:
      - image: circleci/node:8.11.4

jobs:
  setup:
    executor:
      name: default
    steps:
      - checkout
      - run:
          name: install dependency
          command: npm install gitbook-cli

  deploy:
    executor:
      name: default
    steps:
      - checkout
      - run:
          name: install dependencies
          command: |
              git config --global user.name  $USERNAME
              git config --global user.email $EMAIL
              gitbook install
              gitbook build
              cd _book/
              git init
              git commit --allow-empty -m '[ci skip] update docs'
              git checkout -b gh-pages
              git add .
              git commit -am '[ci skip] update docs'
              git push --force git@github.com:ToruNiina/pnm.git gh-pages


workflows:
  setup_and_deploy:
    jobs:
      - setup
      - deploy:
          name: update docs
          requires:
            - setup
          filters:
            branches:
              only: master
